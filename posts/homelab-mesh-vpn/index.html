<!doctype html><html data-color-scheme=auto><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><title>Comparing tools to connect your devices in a mesh VPN · Sid Verma</title><link rel=stylesheet href=/css/rocinante.min.css><link rel=stylesheet type=text/css href=https://sidverma.io/css/style.43d9f1db361927f335592361b86ccbd6cfa942114cc7afe99c1a78eb7a648cb0.css><link rel="shortcut icon" href=/icons/favicon.ico><body><header><h2><a class=site-title href=https://sidverma.io/>‹ Sid Verma</a></h2></header><main><div class=post><div class=title-group><div class=title><h1>Comparing tools to connect your devices in a mesh VPN</h1></div><div class=date><h5>Jan 03, 2023</h5></div></div><article class=content><p>I have a nice little computer in my house which hosts a bunch of services I use. It sits behind a NAT, so I can&rsquo;t connect directly to it via my public IP address. Hence, I use a cheap cloud instance on DigitalOcean to act as the gateway for my home-server to the internet.</p><p>My <a href=/2020/01/11/personal-infrastructure-overview/#how-things-actually-connect>previous setup</a> was basically a VPN tunnel between a cloud server and my home server, where the cloud server forwarded TCP traffic to my home server, which served all my services.</p><p>Lately, I&rsquo;ve been rebuilding this infrastructure, and one of the things I was due for, is to have all my devices (my cloud server, home server, laptop, phone, etc) connected to each other all the time. Also, it needed to be in a mesh instead of hub-and-spoke, as there was no need for data to go over the internet if I&rsquo;m home, on the same physical network as my home-server.</p><p>I spent a good amount of time trying out a bunch of methods, until settling on one. This post runs through all the options I found, and why I chose what I chose. I won&rsquo;t go into how to set it up - there should be plenty of articles and documentation on the internet.
TLDR: I now use tailscale with a headscale server.</p><hr><h3 id=wireguard>Wireguard</h3><p>There&rsquo;s a bunch of ways to do mesh VPN as of writing this. One obvious one is to use <a href=https://www.wireguard.com/quickstart/ target=_blank>Wireguard</a>, which is what I set up first. However, one drawback of it, for my use-case is that peers need an IP address to connect to. Since my IPv4-first ISP puts me behind a NAT, I was unable to do that. So, I had to choose between routing what-could-be local traffic over the internet, or have local peers and only connect to VPN when I&rsquo;m at home. Neither were good solutions for me.</p><p><a href=https://www.jordanwhited.com/posts/wireguard-endpoint-discovery-nat-traversal/ target=_blank>This wonderful post</a> by Jordan Whited uses a STUN mechanism to do IP discovery with wireguard, but I don&rsquo;t want to take on the burden on compiling CoreDNS every time I perform upgrades. If that&rsquo;s something you&rsquo;re okay with, I&rsquo;d highly suggest giving it a try - it&rsquo;s exceptionally neat.</p><h3 id=netmaker>Netmaker</h3><p><a href=https://www.netmaker.org/ target=_blank>Netmaker</a> is another wonderful tool, which is very performant and incredibly easy to set up. It even includes a web-app where you can manage all the nodes. I would recommend this if you don&rsquo;t want your phone to be a part of the mesh. Netmaker uses its own <code>netclient</code> to connect nodes, and there&rsquo;s no such client for Android/iOS, <a href=https://github.com/gravitl/netmaker/discussions/631 target=_blank>as of writing this</a>. You can technically add a phone as an &lsquo;external device&rsquo; via wireguard, but then the phone always uses a specific ingress server to access the VPN, and won&rsquo;t connect directly to a node even when on the same physical network.</p><h3 id=tailscaleheadscale>Tailscale/Headscale</h3><p><a href=https://tailscale.com/ target=_blank>Tailscale</a> is one of the popular Mesh-VPN services providers. It&rsquo;s built on top of wireguard, and uses its own coordination servers to keep track of your devices (a very good write-up of how it does that <a href=https://tailscale.com/blog/how-nat-traversal-works/ target=_blank>here</a>). It has a very stable android client which has worked without issues for me. And more importantly, the official open-source clients support the third-party open-source coordination server, <a href=https://github.com/juanfont/headscale target=_blank>headscale</a>, which I use. The official tailscale server is not open-source, but headscale hasn&rsquo;t given me any issues yet. Tailscale isn&rsquo;t the most performant option out there, but it has been very reliable in maintaining a connection between devices even when they hop between networks (sometimes spotty LTE). I hear the performance is gonna <a href=https://tailscale.com/blog/throughput-improvements/ target=_blank>increase soon</a> too, so that&rsquo;s nice.</p><h3 id=also-nebula-zerotier>Also: Nebula, ZeroTier</h3><p>Two more tools need to be mentioned here.</p><p><a href=https://github.com/slackhq/nebula target=_blank>Nebula</a> is developed by Slack, and builds a similar mesh overlay network. It seems simpler in design, however I had a hard time with the Android client, which sometimes would just not form connections. It could have been just a momentary bug, or a configuration error, but I moved past it very quickly. YMMV.</p><p><a href=https://www.zerotier.com/ target=_blank>Zerotier</a> is very similar to Tailscale too. It uses its own custom protocol instead of wireguard, and works in a similar way. Zerotier&rsquo;s controller server is open source, and can be self-hosted. In my testing, it took longer to reconnect after a network change, and also took more time to figure out the optimal route to a peer, but otherwise it behaved quite the same. It was more performant than tailscale though, with lower ping-times and higher transfer speeds locally (albeit with more packet loss). I would have been happy with it too, and might try it again if tailscale fucks up at some point. So far, I went with tailscale mostly because of the trusted wireguard as base, and reliability of clients handling reconnections.</p></article><br><div class=tags><div class="horizontal-links links"><a href=/tags/homelab/>#homelab</a><a href=/tags/tech/>#tech</a></div></div></article></main><footer><div class=content-container><div class=content><p>Hey friend. I&rsquo;m <b class=sway>Sid</b>.</p><p>This is my home on the internet. Come, have a tour. Please leave your shoes at the door.</p><p>I work with technology for a living - mostly as a software engineer. Some details are available in the resume below. In addition, I&rsquo;m interested in filmmaking, tinkering with electronics, and building a decentralized internet.</p><p>I also like trees.</p><p>Email me if you&rsquo;d like to work together. <em>Or if you just wanna chat.</em><br></p><p class=horizontal-links><a href=/resume target=_blank>Resume</a><a href=/contact class=email-hook id=about-email title="Click to show email">Email</a><a href=https://github.com/mavidser target=_blank>Github</a><a href=https://instagram.com/mavidser target=_blank>Instagram</a></p><p class=horizontal-links><a href=/posts>All Posts</a><a href=/photos>Photo albums</a><a href=/tags>List of tags</a></p></div><div class=footer-text><span class=footer-emoji>✌️</span></div></div></footer><script>const emailId=atob("bWVAc2lkdmVybWEuaW8=");</script><script src=/js/rocinante.min.js></script></body></html>